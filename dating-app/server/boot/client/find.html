<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Find</title>
    <link rel="stylesheet" href="bootswatch_minty.css" />
    <link rel="stylesheet" href="stars.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
      .hidden {
        visibility: hidden;
      }
    </style>
  </head>

  <body>
    <!-- Navbar -->
    <div class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a href="/find" class="navbar-brand">Date Finder</a>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav ml-auto" style="  display: flex;">
            <li class="nav-item logged_out">
              <a class="nav-link" href="/login">Login</a>
            </li>
            <li class="nav-item logged_out">
              <a class="nav-link" href="/signup">Sign Up</a>
            </li>
            <li class="nav-item logged_in hidden">
              <a class="nav-link" href="#" id="username_placement">Username</a>
            </li>
            <li class="nav-item logged_in hidden">
              <a class="nav-link" href="#" id="logout_fn">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- End of Navbar -->

    <div class="container">
      <div class="row" style="padding-top: 5%;">
        <!-- Results Column -->
        <div class="col-sm-3" style="background-color: #989da5; overflow-y: scroll; height: 650px; width: 100%; padding: 2px;" id="results">
        </div>
        <!-- End of Results Column -->

        <div class="col-sm-9">
          <div class="row" style="background-color: #606468">
            <div style="height: 100px; width: 100%"></div>
          </div>
          <div class="row" style="background-color: #6e7d8c">
            <input id="pac-input" class="controls form-control" type="text" placeholder="Search Places">
            <div style="height: 500px; width: 100%" id="map"></div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous"></script>
      <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwSkGuWO4KYNoI6mr17mRxiDlhcVMtuM0&libraries=places"></script> -->
    <script>
      function addPlace(place){
        var card = document.createElement('div');
      //  var image = document.createElement('img');
        var card_body = document.createElement('div');
        var title = document.createElement('h6');
        var desc = document.createElement('p');
       // var link = document.createElement('a');
       

        card.classList.add('card');
      //  image.classList.add('card-img-top');
        card_body.classList.add('card-body');
        title.classList.add('card-title');
        desc.classList.add('card-text')
       // link.classList.add('btn', 'btn-primary');

      //  image.src = place.icon;
        title.innerHTML = place.name;
        desc.innerHTML = place.formatted_address;


      // ratings stuff
        var star_outer = document.createElement('div');
        var star_inner = document.createElement('div');
        var rate_value = document.createElement('span');

        star_outer.classList.add('star-outer');
        star_inner.classList.add('star-inner');
        rate_value.classList.add('number-rating');
        
        // var starPercentageRounded = (Math.round(place.rating / 10) * 10) + '%';
        // star_inner.style.width = '50%';
        rate_value.innerHTML = 'Rate : ' + place.rating + '/5.0';

        //star_outer.appendChild(star_inner);
        star_outer.appendChild(rate_value);
        

      // end of rating stuff


        card_body.appendChild(title);
        card_body.appendChild(desc);
       // card_body.appendChild(link);
        card_body.appendChild(star_outer);

        card.appendChild(card_body);
        card.style.marginBottom = '4px';

        document.getElementById("results").appendChild(card);
      }



      function initAutocomplete() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 39.2543159, lng: -76.7152464},
          zoom: 13,
          mapTypeId: 'roadmap'
        });

        // Create the search box and link it to the UI element.
        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
       // map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });

        var markers = [];
        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function() {
          var places = searchBox.getPlaces();

          if (places.length == 0) {
            return;
          }
          console.log(places)
          // Clear out the old markers.
          markers.forEach(function(marker) {
            marker.setMap(null);
          });
          markers = [];

          // For each place, get the icon, name and location.
          var bounds = new google.maps.LatLngBounds();
          places.forEach(function(place) {
            if (!place.geometry) {
              console.log("Returned place contains no geometry");
              return;
            }

            addPlace(place);

            var icon = {
              url: place.icon,
              size: new google.maps.Size(71, 71),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(17, 34),
              scaledSize: new google.maps.Size(25, 25)
            };

            // Create a marker for each place.
            markers.push(new google.maps.Marker({
              map: map,
              icon: icon,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
          });
          map.fitBounds(bounds);
        });
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwSkGuWO4KYNoI6mr17mRxiDlhcVMtuM0&libraries=places&callback=initAutocomplete"></script>
    <script>
      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(";");
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == " ") {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }

      function deleteCookie(name) {
        document.cookie = name + "=; Max-Age=-99999999;";
      }

      $(document).ready(function() {
        if (getCookie("id") != "") {
          $(".logged_out").addClass("hidden");
          $("#username_placement").text(getCookie("username"));
          $(".logged_in").removeClass("hidden");
        }

        $("#logout_fn").on("click", function() {
          deleteCookie("id");
          deleteCookie("username");
          window.location.replace("http://localhost:3000/login");
        });
      });
    </script>
  </body>
</html>
